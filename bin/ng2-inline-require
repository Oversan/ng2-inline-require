#!/usr/bin/env node

const program = require('commander')
const chalk = require('chalk')
const pkg = require('../package')
const inline = require('../lib/inline')
const fileListCreator = require('../lib/fileListCreator')
const isFile = require('../lib/fileHelpers').isFile
const isDirectory = require('../lib/fileHelpers').isDirectory

function createInlinedFiles(srcPath, destPath) {
  fileListCreator(srcPath, destPath).forEach(item => {
    inline(item.src, item.dest)
  })
}

program
  .version(pkg.version)
  .option('-i, --in [path]', 'Input file path with .ts extension')
  .option('-I, --infolder [path]', 'Input folder path with .ts files')
  .option('-o, --out [path]', 'Output file path with .ts extension')
  .option('-O, --outfolder [path]', 'Output folder path for generated files')
  .parse(process.argv)

if (program.in && program.out) {
  if (program.in.length && program.out.length && isFile(program.in) && !isDirectory(program.out)) {
    createInlinedFiles(program.in, program.out)
  } else {
    console.log(chalk.red('Terminated'))
    console.log(chalk.red('Check options "--in", "--out"'))
  }
}

if (program.infolder && program.outfolder) {
  if (program.infolder.length && program.outfolder.length && isDirectory(program.infolder) && isDirectory(program.outfolder)) {
    createInlinedFiles(program.infolder, program.outfolder)
  } else {
    console.log(chalk.red('Terminated'))
    console.log(chalk.red('Check options "--infolder", "--outfolder"'))
  }
}
